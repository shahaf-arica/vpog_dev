# VPOG Data Configuration
root_dir: ${machine.root_dir}/datasets/

# Dataloader configuration
dataloader:
  _target_: training.dataloader.vpog_dataset.VPOGTrainDataset
  
  # Dataset settings
  dataset_name: gso  # 'gso' or 'shapenet'
  root_dir: ${root_dir}
  depth_scale: 10.0
  
  # Template configuration
  template_config:
    dir: ${root_dir}templates
    level_templates: 1
    pose_distribution: all
    scale_factor: 10.0
    num_templates: 162
    image_name: OBJECT_ID/VIEW_ID.png
    pose_name: object_poses/OBJECT_ID.npy
  
  # Template selection settings
  num_positive_templates: 4  # S_p: nearest out-of-plane templates
  num_negative_templates: 2  # S_n: random negative templates
  min_negative_angle_deg: 90.0  # minimum angle difference for negatives
  d_ref_random_ratio: 0.0  # ratio of random d_ref vs nearest (0.0 = always nearest)
  positive_sampling_mode: nearest  # 'nearest' or 'random_within_range'
  positive_sampling_deg_range: 30.0  # deg range for random sampling mode
  seed: 42  # random seed for reproducibility (null = no seed)
  
  # Patch settings
  patch_size: 16  # CroCo default patch size
  image_size: 224  # input image size
  
  # Flow computation settings
  flow_config:
    compute_visibility: true
    compute_patch_visibility: true  # check if flow stays within patch
    visibility_threshold: 0.1  # minimum visibility fraction
  
  # Augmentation settings (similar to GigaPose)
  transforms: ${transform}
  
  # Dataloader settings
  batch_size: ${machine.batch_size}
  num_workers: ${machine.num_workers}

# Transform configuration (similar to GigaPose)
transform:
  # Normalize transform
  normalize:
    _target_: torchvision.transforms.Compose
    transforms:
      - _target_: torchvision.transforms.Normalize
        mean: [0.48145466, 0.4578275, 0.40821073]
        std: [0.26862954, 0.26130258, 0.27577711]
  
  # Crop transform
  crop_transform:
    _target_: src.utils.crop.CropResizePad
    target_size: 224
  
  # RGB augmentation (similar to GigaPose)
  rgb_transform:
    _target_: megapose.datasets.augmentations.SceneObservationAugmentation
    transform:
      - _target_: megapose.datasets.augmentations.SceneObservationAugmentation
        transform:
          _target_: megapose.datasets.augmentations.PillowBlur
          factor_interval: [1, 3]
        p: 0.4
      - _target_: megapose.datasets.augmentations.SceneObservationAugmentation
        transform:
          _target_: megapose.datasets.augmentations.PillowSharpness
          factor_interval: [0.0, 50.0]
        p: 0.3
      - _target_: megapose.datasets.augmentations.SceneObservationAugmentation
        transform:
          _target_: megapose.datasets.augmentations.PillowContrast
          factor_interval: [0.2, 50.0]
        p: 0.3
      - _target_: megapose.datasets.augmentations.SceneObservationAugmentation
        transform:
          _target_: megapose.datasets.augmentations.PillowBrightness
          factor_interval: [0.1, 6.0]
        p: 0.5
      - _target_: megapose.datasets.augmentations.SceneObservationAugmentation
        transform:
          _target_: megapose.datasets.augmentations.PillowColor
          factor_interval: [0.0, 20.0]
        p: 0.3
    p: 0.8
  
  # Augmentation flags
  crop_augmentation: false
  inplane_augmentation: true  # Important for VPOG
  rgb_augmentation: true

# Visualization settings for debugging
visualization:
  enabled: false  # Set to true to save visualizations
  save_dir: ${vis_dir}
  save_frequency: 100  # Save every N batches
  max_samples_per_batch: 4  # Max samples to visualize per batch
