# VPOG Model Configuration (CroCo Large)
# Configuration for Visual Patch-wise Object pose estimation with Groups of templates
# 
# To switch encoders:
#   python train.py model=vpog_croco_base
#   python train.py model=vpog_dinov2
#   python train.py model.encoder=croco_base

defaults:
  - encoder: croco_large

# Model parameters
patch_size: 16
img_size: 224

# AA Module configuration
aa_module:
  _target_: vpog.models.aa_module.AAModule
  cfg:
    _target_: vpog.models.aa_module.AAConfig
    dim: 1024           # Must match encoder embed_dim (1024 for Large, 768 for Base)
    depth: 12
    num_heads: 16       # Must match encoder num_heads
    window_size: 7
    mlp_ratio: 4.0
    attn_drop: 0.0
    proj_drop: 0.0
    use_so3prope: true
    so3_frac: 0.5
    rope2d_freq: 100.0

# Classification head configuration
classification_head:
  _target_: vpog.models.classification_head.ClassificationHead
  cfg:
    _target_: vpog.models.classification_head.ClassificationHeadConfig
    in_dim: 1024        # Must match encoder embed_dim
    proj_dim: 256
    hidden_dim: 512
    num_layers: 2
    dropout: 0.0
    use_layernorm: true
    normalize: true
    learnable_temperature: true
    init_temperature: 14.285714  # 1 / 0.07

# Coarse flow head configuration
center_flow_head:
  _target_: vpog.models.flow_head.CenterFlowHead
  in_dim: 1024        # Must match encoder embed_dim
  hidden_dims: [256, 256, 256]  # 3 layers of 256
  dropout: 0.0
  use_layernorm: true

# Refined flow head configuration
dense_flow_head:
  _target_: vpog.models.flow_head.BuddyDenseFlowHead
  in_dim: 1024        # Must match encoder embed_dim
  ps: 16              # Must match patch_size
  hidden_dims: [256, 256, 256]  # 3 layers of 256
  dropout: 0.0
  use_layernorm: true
  eps_b: 0.0001

# # Classification head configuration
# classification_head:
#   _target_: vpog.models.classification_head.ClassificationHead
#   cfg:
#     _target_: vpog.models.classification_head.ClassificationHeadConfig
#     in_dim: 1024        # Must match encoder embed_dim
#     proj_dim: 256
#     hidden_dim: 512
#     num_layers: 2
#     dropout: 0.0
#     use_layernorm: true
#     normalize: true
#     learnable_temperature: true
#     init_temperature: 14.285714  # 1 / 0.07

# # Flow head configuration
# flow_head:
#   _target_: vpog.models.flow_head.FlowHead
#   cfg:
#     _target_: vpog.models.flow_head.BuddyFlowHeadConfig
#     in_dim: 1024        # Must match encoder embed_dim
#     ps: 16              # Must match patch_size
#     hidden_dims: [256, 256, 256]  # 3 layers of 256
#     dropout: 0.0
#     use_layernorm: true
#     eps_b: 0.0001
#   center_hidden_dims: [256, 128]
#   center_dropout: 0.0
#   center_use_layernorm: true
